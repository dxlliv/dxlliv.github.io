var D=Object.defineProperty;var O=(o,e,t)=>e in o?D(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var d=(o,e,t)=>O(o,typeof e!="symbol"?e+"":e,t);import{e as $,k as u,l as r,o as s,w as a,J as b,_ as A,b as _,G as V,r as w,q as U,f as F,W,g as z,c as M,m as y,j as c,F as k,p as H,H as I,a as T,d as N,t as B,ax as q}from"./T0JfaOLC.js";import J from"./CaBqG-VH.js";const K=$({__name:"AgentMessage",props:{author:{}},setup(o){return(e,t)=>{const n=u("v-card");return s(),r(n,{class:"d-inline-block text-subtitle-2 px-4 py-3",color:e.author==="me"?"grey-lighten-2":"grey-lighten-4",rounded:"",flat:"","max-width":"70%"},{default:a(()=>[b(e.$slots,"default",{},void 0,!0)]),_:3},8,["color"])}}}),E=Object.assign(A(K,[["__scopeId","data-v-c0bf2b7f"]]),{__name:"AgentMessage"}),P={};function G(o,e){const t=u("v-progress-linear"),n=E;return s(),r(n,{author:"bot",width:56},{default:a(()=>[_(t,{indeterminate:"",color:"grey-lighten-2"})]),_:1})}const Q=Object.assign(A(P,[["render",G]]),{__name:"AgentMessageWaiting"});class x{constructor(e,t){d(this,"chat",[]);d(this,"listElement");d(this,"agentBaseURL");d(this,"userId");d(this,"roomId");d(this,"textNotAvailable","agent.reply.notAvailable");this.listElement=e,this.agentBaseURL=t,this.userId=x.generateID("xxxxxxx"),this.roomId=`room-${x.generateID("xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx")}`}static generateID(e){return e.replace(/[xy]/g,t=>{const n=Math.random()*16|0;return(t==="x"?n:n&3|8).toString(16)})}scrollToBottom(){this.listElement.$el.scrollTop=this.listElement.$el.scrollHeight}addNewMessage(e,t){this.chat.push({author:e,text:t}),setTimeout(()=>{this.scrollToBottom()},25)}async sendMessage(e,t){const n=new AbortController,i=setTimeout(()=>{n.abort()},5e3),m={text:e,userId:this.userId,roomId:this.roomId},g=`${this.agentBaseURL}/message`;await fetch(g,{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(m),signal:n.signal}).then(l=>{if(clearTimeout(i),!l.ok)throw new Error(`Request failed with status: ${l.status}`);return l.json()}).then(l=>{l.length>0&&this.addNewMessage("bot",l[0].text)}).catch(async()=>new Promise(l=>setTimeout(()=>{this.addNewMessage("bot",t(this.textNotAvailable)),l(!0)},3e3)))}}const X=V("agent",()=>{const o=w(null),e=w("");function t(n,i){o.value||(o.value=new x(n,i))}return{agent:o,text:e,initialize:t}}),Y=["innerHTML"],Z=$({__name:"AgentForm",setup(o){const e=X(),t=U(),{t:n}=F(),i=t.agent.baseURL,m=W("listElement"),g=w(!1);z(()=>{e.initialize(m,i,n("agent.reply.notAvailable"))});async function l(){const p=String(e.text);e.text="",e.agent.addNewMessage("me",p),g.value=!0,await e.agent.sendMessage(p,n),g.value=!1}return(p,f)=>{const L=E,v=u("v-list-item"),S=Q,j=u("v-list"),C=J,R=u("v-text-field");return s(),M(k,null,[c(e).agent?(s(),r(j,{key:0,ref_key:"listElement",ref:m,class:"mt-2",height:"50vh","max-height":400},{default:a(()=>[(s(!0),M(k,null,H(c(e).agent.chat,h=>(s(),r(v,{class:I(["py-1"])},{default:a(()=>[_(L,{author:h.author,class:I([{"float-right":h.author==="me"}])},{default:a(()=>[T("span",{innerHTML:h.text},null,8,Y)]),_:2},1032,["author","class"])]),_:2},1024))),256)),c(g)?(s(),r(v,{key:0,class:"py-1"},{default:a(()=>[_(S)]),_:1})):y("",!0),c(e).agent.chat&&c(e).agent.chat.length===0?(s(),r(v,{key:1,class:"fill-height text-center"},{default:a(()=>[N(B(p.$t("agent.intro.line1")),1),f[1]||(f[1]=T("br",null,null,-1)),N(" "+B(p.$t("agent.intro.line2")),1)]),_:1})):y("",!0)]),_:1},512)):y("",!0),_(R,{modelValue:c(e).text,"onUpdate:modelValue":f[0]||(f[0]=h=>c(e).text=h),variant:"solo",flat:"","hide-details":"",autocomplete:"off",spellcheck:"false",readonly:c(g),placeholder:p.$t("agent.field"),onKeydown:q(l,["enter"])},{prepend:a(()=>[_(C,{name:"mdi:account-circle-outline",size:24,class:"ml-5 mr-n4 text-grey-darken-3"})]),_:1},8,["modelValue","readonly","placeholder"])],64)}}}),ee=Object.assign(Z,{__name:"AgentForm"}),te=$({__name:"AppDialog",props:{fullscreen:{type:Boolean},dialogMaxWidth:{default:"calc(100vw - 36px)"}},setup(o){return(e,t)=>{const n=u("v-card"),i=u("v-bottom-sheet"),m=u("v-dialog");return e.$vuetify.display.xs?(s(),r(i,{key:0,activator:"parent"},{default:a(()=>[_(n,{class:"v-card--rounded-top"},{default:a(()=>[b(e.$slots,"default")]),_:3})]),_:3})):(s(),r(m,{key:1,width:600,"max-width":e.dialogMaxWidth,fullscreen:e.fullscreen,transition:"dialog-bottom-transition",activator:"parent"},{default:a(()=>[_(n,{rounded:!e.fullscreen},{default:a(()=>[b(e.$slots,"default")]),_:3},8,["rounded"])]),_:3},8,["max-width","fullscreen"]))}}}),ne=Object.assign(te,{__name:"AppDialog"}),oe={};function ae(o,e){const t=ee,n=ne;return s(),r(n,null,{default:a(()=>[_(t)]),_:1})}const ie=Object.assign(A(oe,[["render",ae]]),{__name:"AgentLauncher"});export{ne as _,ie as a};
